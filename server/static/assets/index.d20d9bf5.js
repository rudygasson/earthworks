import{p as u}from"./vendor.fb5514cc.js";const O=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))a(o);new MutationObserver(o=>{for(const d of o)if(d.type==="childList")for(const c of d.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const d={};return o.integrity&&(d.integrity=o.integrity),o.referrerpolicy&&(d.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?d.credentials="include":o.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function a(o){if(o.ep)return;o.ep=!0;const d=n(o);fetch(o.href,d)}};O();const p="urn:ogc:def:crs:EPSG::27700",C="+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489 +units=m +no_defs",y="WGS84";u.defs(p,C);function I(e){let t=u(p,y,e);return L.latLng(t[1],t[0])}function k(e){let t=u(y,p,[e[1],e[0]]);return[Math.round(t[0]),Math.round(t[1])]}function D({lat:e,lng:t}){let[n,a]=k([e,t]);return`[${n}, ${a}]`}function m(e,t,n){if(!e)throw console.table(t),new Error(n||"Assertion failed")}const R="http://{s}.tile.osm.org/{z}/{x}/{y}.png",v='\xA9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',N=' | Adam Carins & <a href="https://github.com/rudygasson" target="_blank">Rudy Gasson</a>',_={lat:52.561928,lng:-1.464854},E=7,b=13,T=.25;function x(){const e=L.map("mapdiv",{center:_,zoom:E,zoomSnap:T,zoomDelta:T}),t=L.tileLayer(R,{attribution:v+N});return e.addLayer(t),e}function f(e,t=e.getCenter()){document.getElementById("mouse-location").innerText=D(t),document.getElementById("zoom-level").innerText=e.getZoom().toFixed(2)}function A(e){let t=document.querySelector("#area-table tbody");e.forEach((n,a)=>{let o=document.createTextNode(n.due.count||""),d=document.createTextNode(n.due.length_km||""),c=document.createTextNode(n.overdue.count||""),s=document.createTextNode(n.overdue.length_km||""),l=document.createElement("tr"),r=document.createElement("td");r.appendChild(document.createTextNode(n.id)),l.appendChild(r),r=document.createElement("td"),r.classList.add("in-year"),r.appendChild(o),l.appendChild(r),r=document.createElement("td"),r.classList.add("in-year"),r.appendChild(d),l.appendChild(r),r=document.createElement("td"),r.classList.add("backlog"),r.appendChild(c),l.appendChild(r),r=document.createElement("td"),r.classList.add("backlog"),r.appendChild(s),l.appendChild(r),t.appendChild(l)})}function M(e){let t=e.target._map;t.getZoom()<b&&t.flyTo(e.latlng,b);let n=z(e.layer.feature.properties.earthwork_number),a=e.target.getPopup(),o={earthwork_number:"ID:",earthwork_type:"Type:",earthwork_length_m:"Length (m):",road:"Road:",last_complete_inspection_date:"Last Insp.:",next_principal_inspection_date:"Next Insp.:"},d=document.createElement("tbody"),c="<td style='padding: 0 0.2rem'>";n.then(s=>{for(let l of Object.keys(o)){let r="<tr>"+c+o[l]+"</td>"+c+s.properties[l].toString()+"</td></tr>";d.innerHTML+=r}a.setContent(d),a.update()})}const h="http://localhost:5000/earthworks",S="darkorange",U="red",G=8,i={};async function j(){let e=new URL(h);return fetch(e+"/areas?q=table").then(t=>t.json())}async function B(e){if(i[e])return i[e];let t=await w({next_pi:"due",area:e}),n=await w({next_pi:"overdue",area:e});return n.features.map(a=>{a.properties.overdue=!0}),i[e]=L.geoJson(t,{coordsToLatLng:I,style:{color:S,weight:G}}),i[e].addData(n).eachLayer(a=>{a.feature.properties.overdue&&(a.options.color=U)}),i[e].bindPopup("Loading..."),i[e].on("click",M),i[e]}async function z(e){let t=new URL(h);return fetch(t+`/${e}`).then(n=>n.json())}async function w(e={next_pi:"due",area:10}){let t=new URL(h);return m(typeof t=="object",t),m(t.pathname==="/earthworks",t),Object.keys(e).forEach(n=>{t.searchParams.set(n,e[n])}),fetch(t).then(n=>n.json())}const g=L.layerGroup([]);function P(e){g.addTo(e),e.doubleClickZoom.disable(),e.on("mousemove zoom",t=>f(e,t.latlng)),document.getElementById("btnCentroid").onclick=()=>{e.setView(_,E),f(e,e.getCenter())},document.getElementById("area-table").onclick=async t=>{let n=t.target.parentElement.firstChild.textContent;if(!parseInt(n))return;let a=await B(n);g.clearLayers(),e.fitBounds(a.getBounds()),g.addLayer(a)}}document.onreadystatechange=async function(){if(document.readyState==="complete"){let e=await j();m(e.length>0,e,"No area data available");let t=x();f(t),P(t),A(e)}};
