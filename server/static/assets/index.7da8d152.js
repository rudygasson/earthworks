import{p}from"./vendor.fb5514cc.js";const b=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}};b();const m="urn:ogc:def:crs:EPSG::27700",I="+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +towgs84=446.448,-125.157,542.06,0.15,0.247,0.842,-20.489 +units=m +no_defs",E="WGS84";p.defs(m,I);function D(e){let t=p(m,E,e);return L.latLng(t[1],t[0])}function R(e){let t=p(E,m,[e[1],e[0]]);return[Math.round(t[0]),Math.round(t[1])]}function f({lat:e,lng:t}){let[n,r]=R([e,t]);return`[${n}, ${r}]`}function h(e,t,n){if(!e)throw console.table(t),new Error(n||"Assertion failed")}const k="http://{s}.tile.osm.org/{z}/{x}/{y}.png",v='\xA9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',N=' | Adam Carins & <a href="https://rudygasson.de">Rudy Gasson</a>',s={lat:52.561928,lng:-1.464854},T=7,C=13,w=.25;function x(){const e=L.map("mapdiv",{center:s,zoom:T,zoomSnap:w,zoomDelta:w}),t=L.tileLayer(k,{attribution:v+N});return e.addLayer(t),e}function g(e,t=e.getCenter()){document.getElementById("mouse-location").innerText=f(t),document.getElementById("map-centre").innerText=f(e.getCenter()),document.getElementById("zoom-level").innerText=e.getZoom()}function A(e){let t=document.querySelector("#area-table tbody");e.forEach((n,r)=>{let o=document.createTextNode(n.due.count||""),a=document.createTextNode(n.due.length_km||""),c=document.createTextNode(n.overdue.count||""),u=document.createTextNode(n.overdue.length_km||""),l=document.createElement("tr"),d=document.createElement("td");d.appendChild(document.createTextNode(n.id)),l.appendChild(d),d=document.createElement("td"),d.appendChild(o),l.appendChild(d),d=document.createElement("td"),d.appendChild(a),l.appendChild(d),d=document.createElement("td"),d.appendChild(c),l.appendChild(d),d=document.createElement("td"),d.appendChild(u),l.appendChild(d),t.appendChild(l)})}function M(e){let t=e.target._map;t.getZoom()<C&&t.flyTo(e.latlng,C);let n=P(e.layer.feature.properties.earthwork_number),r=e.target.getPopup(),o={earthwork_number:"ID:",earthwork_type:"Type:",earthwork_length_m:"Length (m):",road:"Road:",last_complete_inspection_date:"Last Insp.:",next_principal_inspection_date:"Next Insp.:"},a=document.createElement("tbody"),c="<td style='padding: 0 0.2rem'>";n.then(u=>{for(let l of Object.keys(o)){let d="<tr>"+c+o[l]+"</td>"+c+u.properties[l].toString()+"</td></tr>";a.innerHTML+=d}r.setContent(a),r.update()})}const y="http://localhost:5000/earthworks",S="darkorange",U="red",G=8,i={};async function B(){let e=new URL(y);return fetch(e+"/areas?q=table").then(t=>t.json())}async function j(e){if(i[e])return i[e];let t=await O({next_pi:"due",area:e}),n=await O({next_pi:"overdue",area:e});return n.features.map(r=>{r.properties.overdue=!0}),i[e]=L.geoJson(t,{coordsToLatLng:D,style:{color:S,weight:G}}),i[e].addData(n).eachLayer(r=>{r.feature.properties.overdue&&(r.options.color=U)}),i[e].bindPopup("Loading..."),i[e].on("click",M),i[e]}async function P(e){let t=new URL(y);return fetch(t+`/${e}`).then(n=>n.json())}async function O(e={next_pi:"due",area:10}){let t=new URL(y);return h(typeof t=="object",t),h(t.pathname==="/earthworks",t),Object.keys(e).forEach(n=>{t.searchParams.set(n,e[n])}),fetch(t).then(n=>n.json())}const _=L.layerGroup([]);function z(e){_.addTo(e),e.doubleClickZoom.disable(),e.on("mousemove zoom",n=>g(e,n.latlng));const t=L.popup().setLatLng(s).setContent("<h2>Centre of England</h2>"+f(s));document.getElementById("btnCentroid").onclick=()=>{e.openPopup(t).setView(s,T),g(e,e.getCenter())},document.getElementById("area-table").onclick=async n=>{let r=n.target.parentElement.firstChild.textContent;if(!parseInt(r))return;let o=await j(r);_.clearLayers(),e.fitBounds(o.getBounds()),_.addLayer(o)}}document.onreadystatechange=async function(){if(document.readyState==="complete"){let e=await B();h(e.length>0,e,"No area data available");let t=x();g(t),z(t),A(e)}};
